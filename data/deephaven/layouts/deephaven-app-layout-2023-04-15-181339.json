{"filterSets":[{"id":"DzrW7fz4d","title":"test","panels":[{"panelId":"DpfONiHdq","type":"IrisGridPanel","state":{"irisGridState":{"advancedFilters":[],"aggregationSettings":{"aggregations":[],"showOnTop":false},"customColumnFormatMap":[],"isFilterBarShown":false,"quickFilters":[],"sorts":[],"userColumnWidths":[],"userRowHeights":[],"customColumns":[],"conditionalFormats":[],"reverseType":"none","showSearchBar":false,"searchValue":"","selectDistinctColumns":[],"selectedSearchColumns":[],"invertSearchColumns":true,"pendingDataMap":[],"frozenColumns":null},"gridState":{"isStuckToBottom":false,"isStuckToRight":false,"movedColumns":[],"movedRows":[]}}},{"panelId":"4aXTIvcCp","type":"IrisGridPanel","state":{"irisGridState":{"advancedFilters":[],"aggregationSettings":{"aggregations":[],"showOnTop":false},"customColumnFormatMap":[],"isFilterBarShown":false,"quickFilters":[],"sorts":[{"column":6,"isAbs":false,"direction":"DESC"}],"userColumnWidths":[],"userRowHeights":[],"customColumns":[],"conditionalFormats":[],"reverseType":"none","showSearchBar":false,"searchValue":"","selectDistinctColumns":[],"selectedSearchColumns":[],"invertSearchColumns":true,"pendingDataMap":[],"frozenColumns":null},"gridState":{"isStuckToBottom":false,"isStuckToRight":false,"movedColumns":[],"movedRows":[]}}},{"panelId":"bv1i8N_h8","type":"IrisGridPanel","state":{"irisGridState":{"advancedFilters":[],"aggregationSettings":{"aggregations":[],"showOnTop":false},"customColumnFormatMap":[],"isFilterBarShown":false,"quickFilters":[],"sorts":[{"column":1,"isAbs":false,"direction":"DESC"}],"userColumnWidths":[],"userRowHeights":[],"customColumns":[],"conditionalFormats":[],"reverseType":"none","showSearchBar":false,"searchValue":"","selectDistinctColumns":[],"selectedSearchColumns":[],"invertSearchColumns":true,"pendingDataMap":[],"frozenColumns":null},"gridState":{"isStuckToBottom":false,"isStuckToRight":false,"movedColumns":[],"movedRows":[]}}},{"panelId":"XR0uLVqtQ","type":"IrisGridPanel","state":{"irisGridState":{"advancedFilters":[],"aggregationSettings":{"aggregations":[],"showOnTop":false},"customColumnFormatMap":[],"isFilterBarShown":false,"quickFilters":[],"sorts":[],"userColumnWidths":[],"userRowHeights":[],"customColumns":[],"conditionalFormats":[],"reverseType":"none","showSearchBar":false,"searchValue":"","selectDistinctColumns":[],"selectedSearchColumns":[],"invertSearchColumns":true,"pendingDataMap":[],"frozenColumns":null},"gridState":{"isStuckToBottom":false,"isStuckToRight":false,"movedColumns":[],"movedRows":[]}}},{"panelId":"ZsIs3l0f_","type":"IrisGridPanel","state":{"irisGridState":{"advancedFilters":[],"aggregationSettings":{"aggregations":[],"showOnTop":false},"customColumnFormatMap":[],"isFilterBarShown":false,"quickFilters":[],"sorts":[],"userColumnWidths":[],"userRowHeights":[],"customColumns":[],"conditionalFormats":[],"reverseType":"none","showSearchBar":false,"searchValue":"","selectDistinctColumns":[],"selectedSearchColumns":[],"invertSearchColumns":true,"pendingDataMap":[],"frozenColumns":null},"gridState":{"isStuckToBottom":true,"isStuckToRight":false,"movedColumns":[],"movedRows":[]}}}],"restoreFullState":false}],"layoutConfig":[{"type":"column","isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","width":100,"content":[{"type":"row","isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","height":59.776849129867735,"content":[{"type":"column","isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","width":53.21605277625069,"content":[{"type":"stack","header":{},"isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","activeItemIndex":0,"width":52.97186932849364,"height":75.37437603993344,"content":[{"type":"react-component","component":"NotebookPanel","isFocusOnShow":false,"props":{"metadata":{"id":"nu4bUScg6R"},"panelState":{"settings":{"language":"python"},"fileMetadata":{"id":"/stream_trades.py","itemName":"/stream_trades.py"},"isPreview":false}},"title":"stream_trades.py","id":"nu4bUScg6R","componentName":"lm-react-component","isClosable":true,"reorderEnabled":true,"componentState":null},{"type":"react-component","component":"NotebookPanel","isFocusOnShow":false,"props":{"metadata":{"id":"D8y_njfIx"},"panelState":{"settings":{"language":"python","value":"import clickhouse_connect\nimport jpy\nimport time\nimport json\nimport numpy as np\nimport deephaven.dtypes as dht\nimport deephaven.pandas as dhpd\nfrom deephaven.plot.figure import Figure\nimport deephaven.stream.kafka.consumer as ck\nfrom deephaven import agg, merge\nfrom deephaven.table import Table\nimport deephaven\nimport deephaven_tools as tools\n\n\n\n# stream table from Kafka\norderbooks = ck.consume(\n  {'bootstrap.servers': 'redpanda:29092'},\n  'orderbooks',\n  key_spec=ck.KeyValueSpec.IGNORE,\n  value_spec=ck.json_spec([\n    ('exchange', dht.string),\n    ('symbol', dht.string),\n    ('ts', dht.DateTime),\n    ('bid', dht.string),  # json as string\n    ('ask', dht.string),  # json as string\n  ]),\n  table_type=ck.TableType.stream())\\\n  .update_view([\n    #'is_db = (long) 0',\n    'ts_bin = lowerBin(ts, SECOND)',\n  ])\n\n\ndef extract_book_level(x: str, level: int, field: str) -> np.float64:\n    \"\"\"Orderbook JSON string -> dict() -> float of price/size at level\"\"\"\n    if field == 'price':\n        return np.float64(list(json.loads(x).keys())[level])\n    elif field == 'size':\n        return list(json.loads(x).values())[level]\n\n\nquotes_l1_stream = orderbooks.view([\n  'ts',\n  'ts_bin',\n  'symbol',\n  'bid_size = extract_book_level(bid, 0, `size`)',\n  'ask_size = extract_book_level(ask, 0, `size`)',\n  'bid = extract_book_level(bid, 0, `price`)',\n  'ask = extract_book_level(ask, 0, `price`)',\n  'mid = (bid + ask) / 2',\n  'spread = ask - bid',\n  'spread_bps = spread / mid * 10000',\n])\n\n# create ring table\nquotes_l1_ring = tools.make_ring(quotes_l1_stream, 200000).tail_by(50000, ['symbol', 'ts_bin'])\n\nquotes_per_second = orderbooks\\\n  .agg_by([agg.count_('count')], by=[\"ts_bin\"])\\\n  .tail(10)\n\n\n\n# some plots\nquotes_one_symbol = quotes_l1_ring.where(['symbol == `BTC-USD`'])\n\nplot_bid_vs_ask = Figure()\\\n  .plot_xy(series_name=\"BID\", t=quotes_one_symbol, x=\"ts\", y=\"bid\")\\\n  .plot_xy(series_name=\"ASK\", t=quotes_one_symbol, x=\"ts\", y=\"ask\")\\\n  .show()\n\n#plot bid-ask spread\nplot_spread_bps = Figure()\\\n  .plot_xy(series_name=\"SPREAD_BPS\", t=quotes_one_symbol, x=\"ts\", y=\"spread_bps\")\\\n  .show()\n\n \n# from deephaven.plot import LineEndStyle, LineJoinStyle, LineStyle, Colors\n\n# figure = Figure()\n# plot_step = figure\\\n#     .axes(plot_style=PlotStyle.STEP)\\\n#     .plot_xy(series_name=\"HeartRate\", t=source, x=\"Time\", y=\"HeartRate\")\\\n#     .line(style=LineStyle(width=1.0, end_style=LineEndStyle.ROUND))\\\n#     .show()\n\n# f = Figure(rows=1, cols=2)\\\n#     .new_chart(row=0, col=0).plot_xy(series_name=\"SPREAD\", t=quotes_one_symbol, x=\"ts\", y=\"spread\")\\\n#     .new_chart(row=0, col=1).plot_xy(series_name=\"SPREAD_BPS\", t=quotes_one_symbol, x=\"ts\", y=\"spread_bps\")\\\n#     .show()\n"},"fileMetadata":{"id":"/stream_orderbooks.py","itemName":"/stream_orderbooks.py"},"isPreview":false}},"title":"stream_orderbooks.py","id":"D8y_njfIx","componentName":"lm-react-component","isClosable":true,"reorderEnabled":true,"componentState":null},{"type":"react-component","component":"NotebookPanel","isFocusOnShow":false,"props":{"metadata":{"id":"gkaurpNkt"},"panelState":{"fileMetadata":{"id":"/test_ryan.py","itemName":"/test_ryan.py"},"settings":{"language":"python"}}},"title":"test_ryan.py","id":"gkaurpNkt","componentName":"lm-react-component","isClosable":true,"reorderEnabled":true,"componentState":null},{"type":"react-component","component":"NotebookPanel","isFocusOnShow":false,"props":{"metadata":{"id":"qmARvyEO1"},"panelState":{"settings":{"language":"python"},"fileMetadata":{"id":"/deephaven_tools.py","itemName":"/deephaven_tools.py"},"isPreview":false}},"title":"deephaven_tools.py","id":"qmARvyEO1","componentName":"lm-react-component","isClosable":true,"reorderEnabled":true,"componentState":null},{"type":"react-component","component":"NotebookPanel","isFocusOnShow":false,"props":{"metadata":{"id":"aTvP8yX1P"},"panelState":{"settings":{"language":"python"},"fileMetadata":{"id":"/zzz_experimental_wip.py","itemName":"/zzz_experimental_wip.py"},"isPreview":false}},"title":"zzz_experimental_wip.py","id":"aTvP8yX1P","componentName":"lm-react-component","isClosable":true,"reorderEnabled":true,"componentState":null},{"type":"react-component","component":"NotebookPanel","isFocusOnShow":false,"props":{"metadata":{"id":"3w0m1LA0R"},"panelState":{"settings":{"language":"python"},"fileMetadata":{"id":"/init_app.py","itemName":"/init_app.py"},"isPreview":true}},"title":"init_app.py","id":"3w0m1LA0R","componentName":"lm-react-component","isClosable":true,"reorderEnabled":true,"componentState":null}]},{"type":"stack","header":{},"isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","activeItemIndex":0,"height":24.625623960066555,"content":[{"type":"react-component","component":"IrisGridPanel","props":{"metadata":{"name":"last_trade","table":"last_trade","type":"Table"},"panelState":{"irisGridPanelState":{"isSelectingPartition":false,"advancedSettings":[["filter-control-change-clears-all-filters",false],["link-change-clears-all-filters",false]]},"irisGridState":{"advancedFilters":[],"aggregationSettings":{"aggregations":[],"showOnTop":false},"customColumnFormatMap":[],"isFilterBarShown":false,"quickFilters":[],"sorts":[],"userColumnWidths":[],"userRowHeights":[],"customColumns":[],"conditionalFormats":[],"reverseType":"none","showSearchBar":false,"searchValue":"","selectDistinctColumns":[],"selectedSearchColumns":[],"invertSearchColumns":true,"pendingDataMap":[],"frozenColumns":null,"columnHeaderGroups":[]},"gridState":{"isStuckToBottom":true,"isStuckToRight":false,"movedColumns":[],"movedRows":[]},"pluginState":null}},"title":"last_trade","id":"kQnxmcmqCK","componentName":"lm-react-component","isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"componentState":null}]}]},{"type":"column","isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","width":46.78394722374931,"content":[{"type":"stack","width":46.78394722374931,"isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","activeItemIndex":0,"height":74.37603993344426,"content":[{"type":"react-component","component":"ConsolePanel","title":"Console","isClosable":false,"id":"KiyW2fUmK","props":{"metadata":{},"panelState":{"consoleSettings":{"isAutoLaunchPanelsEnabled":true,"isPrintStdOutEnabled":true,"isClosePanelsOnDisconnectEnabled":true},"itemIds":[["trades_kafka","R9HL8-Fzk"],["first_ts","y9PtaD2Poj"],["trades_clickhouse","nY1q38wFKa"],["trades_stream","ZujuJ1XBlL"],["trades_ring","CtOMHE81L"],["snap","nruW7N_JsG"],["tick_count_by_exch","iaHIDGiOPJ"],["last_trade","kQnxmcmqCK"],["trades","e_rMwss9b"],["plot_trades_one_symbol","TIrQDyHAy"]]}},"componentName":"lm-react-component","isFocusOnShow":true,"reorderEnabled":true,"componentState":null},{"type":"react-component","component":"FileExplorerPanel","title":"File Explorer","isClosable":false,"id":"j9dfJUnqbF","props":{"metadata":{}},"componentName":"lm-react-component","isFocusOnShow":true,"reorderEnabled":true,"componentState":null},{"type":"react-component","component":"LogPanel","title":"Log","isClosable":false,"id":"eMflbcDpXM","props":{"metadata":{}},"componentName":"lm-react-component","isFocusOnShow":true,"reorderEnabled":true,"componentState":null},{"type":"react-component","component":"CommandHistoryPanel","title":"Command History","isClosable":false,"id":"lwmxiAFjm8","props":{"metadata":{},"panelState":{}},"componentName":"lm-react-component","isFocusOnShow":true,"reorderEnabled":true,"componentState":null}]},{"type":"stack","header":{},"isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","activeItemIndex":0,"height":25.62396006655574,"content":[{"type":"react-component","component":"MarkdownPanel","props":{"metadata":{},"panelState":{"content":"### Instructions: \nDouble-click the **symbol** column in the **last_trade** tab to see the Linker in action!"}},"title":"Markdown","id":"CaeZQ_LlO","componentName":"lm-react-component","isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"componentState":null}]}]}]},{"type":"row","isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","height":40.223150870132265,"content":[{"type":"stack","header":{},"isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","activeItemIndex":0,"height":40.223150870132265,"width":53.161077515118194,"content":[{"type":"react-component","component":"IrisGridPanel","props":{"metadata":{"name":"trades","table":"trades","type":"Table"},"panelState":{"irisGridPanelState":{"isSelectingPartition":false,"advancedSettings":[["filter-control-change-clears-all-filters",false],["link-change-clears-all-filters",false]]},"irisGridState":{"advancedFilters":[],"aggregationSettings":{"aggregations":[],"showOnTop":false},"customColumnFormatMap":[],"isFilterBarShown":false,"quickFilters":[[0,{"text":"ETH-USD"}]],"sorts":[],"userColumnWidths":[],"userRowHeights":[],"customColumns":[],"conditionalFormats":[],"reverseType":"none","showSearchBar":false,"searchValue":"","selectDistinctColumns":[],"selectedSearchColumns":[],"invertSearchColumns":true,"pendingDataMap":[],"frozenColumns":null,"columnHeaderGroups":[]},"gridState":{"isStuckToBottom":false,"isStuckToRight":false,"movedColumns":[],"movedRows":[]},"pluginState":null}},"title":"trades","id":"9NfbZF-RQ","componentName":"lm-react-component","isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"componentState":null}]},{"type":"stack","header":{},"isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"title":"","activeItemIndex":0,"width":46.838922484881806,"content":[{"type":"react-component","component":"ChartPanel","props":{"metadata":{"settings":{"type":"2","series":["price"],"xAxis":"ts","isLinked":true},"sourcePanelId":"9NfbZF-RQ","table":"trades","tableSettings":{"advancedFilters":[],"inputFilters":[],"quickFilters":[[0,{"text":"ETH-USD"}]],"sorts":[]}},"panelState":{"settings":{},"tableSettings":{"advancedFilters":[],"inputFilters":[],"quickFilters":[[0,{"text":"SOL-USD"}]],"sorts":[]},"filterValueMap":[]}},"title":"Ticks for one symbol","id":"4J9io0KZT","componentName":"lm-react-component","isClosable":true,"isFocusOnShow":true,"reorderEnabled":true,"componentState":null}]}]}]}],"links":[{"start":{"panelId":"kQnxmcmqCK","panelComponent":"IrisGridPanel","columnName":"symbol","columnType":"java.lang.String"},"end":{"panelId":"9NfbZF-RQ","panelComponent":"IrisGridPanel","columnName":"symbol","columnType":"java.lang.String"},"id":"GFqfRbptF","type":"tableLink","operator":"eq"}],"version":2}